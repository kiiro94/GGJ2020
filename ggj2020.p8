pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
--main


printh("---------------------")


--Screen from 0 to 127
--Data   from 1 to 128

function makePoint(x, y, col)
   return {
	  x = x,
	  y = y,
	  s = 1,
	  c = col
   }
end

function destroyPoint(x,y)
   for p in all(data) do
     dist = sqrt((p.x - x)^2 + (p.y - y)^2)
	  if dist < rnd(5)+5 and p.s == 1 then
		 p.s = 0
       createParticle(p.x, p.y, p.c)
	  end
   end
end

function recreateEveryPoint()
   for p in all(data) do	
		p.s = 1
	end
   particles = {}
end

function createParticle(x, y, c)
   add(particles, {x = x, y = y, c = c, sx = rnd(5)+1, sy = rnd(2)-1})
end


function getStruct()
   cls()
   spr(1, 0, 0, 16, 16)
   struct = {}
   for j=0,127 do
	  for i=0,127 do
       pt = pget(i,j)
		 if pt!=0 then
			add(struct, makePoint(i, j, pt))
		 end
	  end
   end
   cls()
   return struct
end

function drawPoint(p)
   if p.s==1 then
	  pset(p.x, p.y, p.c)
   end
end

function drawStruct()
   foreach(data, drawPoint)
end

function drawParticles()
   for p in all(particles) do
      pset(p.x, p.y, p.c)
   end
end

function animateParticles()
   for p in all(particles) do
      p.x -= p.sx
      p.y += p.sy

      if (p.x < 0) then
         del(particles, p)
      end
   end
end


function printData()
   for j=1,32 do
	  s = ""
	  for i=1,128 do
		 s1 = "0"
		 if (data[j][i]==6) s1 = "."
		 s = s .. s1
	  end
	  printh(s)
   end
end

function createStars()
   s = {}
   for i = 0,50 do
      add(s, {x = rnd(127), y = rnd(127), l = flr(rnd(3))})
   end
   return s
end

function drawStars()
   for s in all(stars) do
      pset(s.x, s.y, 7)
   end
end

function animateStars()
   for s in all(stars) do
      if (s.l == 0) then s.x -= 1
      elseif (s.l == 1) then s.x -= 2
      elseif (s.l == 2) then s.x -= 3 end

      if (s.x < 0) then
         s.x = 129
         s.l = flr(rnd(3))
      end
   end
end



--------------------------------




function _init()
    poke(0x5F2D, 1)
	mx = stat(32)
	my = stat(33)
	mb = stat(34)
	data = getStruct()
	t = 0
	pset(127,0,8)

   particles = {}
   stars = createStars()
end


function mouseLeft()
	destroyPoint(mx, my)
end

function mouseRight()
   recreateEveryPoint()
end

function _update()
	mx = stat(32)
	my = stat(33)


	if mb==0 then
		mb = stat(34)
		if mb==1 then
		   mouseLeft()
		elseif mb==2 then
         mouseRight()
      end
	end
	mb = stat(34)

   t += 1

   animateParticles()
   animateStars()
end





function _draw()
   cls()
   drawStars()
   drawStruct()
   drawParticles()
   pset(mx, my, 8)
   print("Mem :"..stat(0), 0,  0, 8)
   print("Cpu1:"..stat(1), 0,  8, 8)
   print("Cpu2:"..stat(2), 0, 16, 8)
   print("Fps :"..stat(7), 0, 24, 8)
   print("mx: " .. mx, 0, 32, 8)
   print("my: " .. my, 0, 40, 8)
   print("mb: " .. mb, 0, 48, 8)
end




--cose
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000007777000000000000000000000000000000000000777700000000000000000000000000000000000000000
00000000000000000000000000000000000000000007777000000000000000000000000000000000000777700000000000000000000000000000000000000000
0000000000000000000000000000000000000000077dd7700000000000000000000000000000000000077dd77000000000000000000000000000000000000000
0000000000000000000000000000000000000000077dd7700000000000000000000000000000000000077dd77000000000000000000000000000000000000000
00000000000000000000000000000000000000000dddd7700000000000000777777770000000000000077dddd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dddd7700000000000000777777770000000000000077dddd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dddd770000000000007700dddd007700000000000077dddd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dddd770000000000007700dddd007700000000000077dddd000000000000000000000000000000000000000
0000000000000000000000000000000000000000000dd770000000000776600dddd006677000000000077dd00000000000000000000000000000000000000000
0000000000000000000000000000000000000000000dd770000000000776600dddd006677000000000077dd00000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd00770000000077666600dddd00666677000000007700dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd00770000000077666600dddd00666677000000007700dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd0077000000006666dd00dddd00dd6666000000007700dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd0077000000006666dd00dddd00dd6666000000007700dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd00770000000066dddd00dddd00dddd66000000007700dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd00770000000066dddd00dddd00dddd66000000007700dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd007700000000dddd00dddddddd00dddd000000007700dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd007700000000dddd00dddddddd00dddd000000007700dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd007700000000dd00dd11dddd11dd00dd000000007700dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd007700000000dd00dd11dddd11dd00dd000000007700dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd0000ff00000000dddd88111188dddd00000000ff0000dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd0000ff00000000dddd88111188dddd00000000ff0000dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd00ff88000000dddd888811118888dddd00000088ff00dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd00ff88000000dddd888811118888dddd00000088ff00dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd00ee88000000dddd8811dddd1188dddd00000088ee00dd000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd00ee88000000dddd8811dddd1188dddd00000088ee00dd000000000000000000000000000000000000000
0000000000000000000000000000000000000000000ff8888000000dd6611dddddddd1166dd0000008888ff00000000000000000000000000000000000000000
0000000000000000000000000000000000000000000ff8888000000dd6611dddddddd1166dd0000008888ff00000000000000000000000000000000000000000
00000000000000000000000000000000000000000ff888888000000dd66dd88111188dd66dd000000888888ff000000000000000000000000000000000000000
00000000000000000000000000000000000000000ff888888000000dd66dd88111188dd66dd000000888888ff000000000000000000000000000000000000000
00000000000000000000000000000000000000000ee888888000000dddd888811118888dddd000000888888ee000000000000000000000000000000000000000
00000000000000000000000000000000000000000ee888888000000dddd888811118888dddd000000888888ee000000000000000000000000000000000000000
000000000000000000000000000000000000000ff88778888000000dddd8811dddd1188dddd00000088887788ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff88778888000000dddd8811dddd1188dddd00000088887788ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff88778888000000dd6611dddddddd1166dd00000088887788ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff88778888000000dd6611dddddddd1166dd00000088887788ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff88778888000000dd66dd00000000dd66dd00000088887788ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff88778888000000dd66dd00000000dd66dd00000088887788ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff8877888800dd00dddd006666666600dddd00dd0088887788ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff8877888800dd00dddd006666666600dddd00dd0088887788ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff8888888800dd00dd00dddd1111dddd00dd00dd0088888888ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff8888888800dd00dd00dddd1111dddd00dd00dd0088888888ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff8877888800dd0000dddd11cccc11dddd0000dd0088887788ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff8877888800dd0000dddd11cccc11dddd0000dd0088887788ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff8888888800dd0000dd11cc7777cc11dd0000dd0088888888ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff8888888800dd0000dd11cc7777cc11dd0000dd0088888888ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff8888888800dd0066dd11cccccccc11dd6600dd0088888888ff0000000000000000000000000000000000000
000000000000000000000000000000000000000ff8888888800dd0066dd11cccccccc11dd6600dd0088888888ff0000000000000000000000000000000000000
000000000000000000000000000000000006600ff8888888800dd006611cccccccccccc116600dd0088888888ff0066000000000000000000000000000000000
000000000000000000000000000000000006600ff8888888800dd006611cccccccccccc116600dd0088888888ff0066000000000000000000000000000000000
00000000000000000000000000000000066dd00ff888888880000006611cccccccccccc116600000088888888ff00dd660000000000000000000000000000000
00000000000000000000000000000000066dd00ff888888880000006611cccccccccccc116600000088888888ff00dd660000000000000000000000000000000
000000000000000000000000000000066dd0000ee88888888000000dd11cccccccccccc11dd00000088888888ee0000dd6600000000000000000000000000000
000000000000000000000000000000066dd0000ee88888888000000dd11cccccccccccc11dd00000088888888ee0000dd6600000000000000000000000000000
0000000000000000000000000000066dd001100ee88888866000000dd11cccccccccccc11dd00000066888888ee001100dd66000000000000000000000000000
0000000000000000000000000000066dd001100ee88888866000000dd11cccccccccccc11dd00000066888888ee001100dd66000000000000000000000000000
000000000000000000000000000661100dd1100ff88887788000000dd11cccccccccccc11dd00000088778888ff0011dd0011660000000000000000000000000
000000000000000000000000000661100dd1100ff88887788000000dd11cccccccccccc11dd00000088778888ff0011dd0011660000000000000000000000000
000000000000000000000000066dd1100dd1100ff88887788000000dd1111cccccccc1111dd00000088778888ff0011dd0011dd6600000000000000000000000
000000000000000000000000066dd1100dd1100ff88887788000000dd1111cccccccc1111dd00000088778888ff0011dd0011dd6600000000000000000000000
0000000000000000000000066dddd1100dd1100ee8888778800990011dd1111cccc1111dd1100990088778888ee0011dd0011dddd66000000000000000000000
0000000000000000000000066dddd1100dd1100ee8888778800990011dd1111cccc1111dd1100990088778888ee0011dd0011dddd66000000000000000000000
00000000000000000000066dddddd1100dd1100ee887788880099990011dd11111111dd110099990088887788ee0011dd0011dddddd660000000000000000000
00000000000000000000066dddddd1100dd1100ee887788880099990011dd11111111dd110099990088887788ee0011dd0011dddddd660000000000000000000
000000000000000000000dddddddd1100dd1100ee778888880099aa99001111111111110099aa990088888877ee0011dd0011dddddddd0000000000000000000
000000000000000000000dddddddd1100dd1100ee778888880099aa99001111111111110099aa990088888877ee0011dd0011dddddddd0000000000000000000
000000000000000000000dddddddd1100dd1100ee778888880099aaaa9900000000000099aaaa990088888877ee0011dd0011dddddddd0000000000000000000
000000000000000000000dddddddd1100dd1100ee778888880099aaaa9900000000000099aaaa990088888877ee0011dd0011dddddddd0000000000000000000
000000000000000000000dddddd111100dd110077ee88888800999999000000000000000099999900888888ee770011dd001111dddddd0000000000000000000
000000000000000000000dddddd111100dd110077ee88888800999999000000000000000099999900888888ee770011dd001111dddddd0000000000000000000
000000000000000000000111111111100dd1100eeee88880000000000000000000000000000000000008888eeee0011dd0011111111110000000000000000000
000000000000000000000111111111100dd1100eeee88880000000000000000000000000000000000008888eeee0011dd0011111111110000000000000000000
000000000000000000000000000000000dd110088888800000000000000000000000000000000000000008888880011dd0000000000000000000000000000000
000000000000000000000000000000000dd110088888800000000000000000000000000000000000000008888880011dd0000000000000000000000000000000
00000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000
00000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000
0000000000000000000000000000000009999aaaa999900000000000000000000000000000000000000009999aaaa99990000000000000000000000000000000
0000000000000000000000000000000009999aaaa999900000000000000000000000000000000000000009999aaaa99990000000000000000000000000000000
